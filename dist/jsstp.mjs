var i,n=Object,r=Proxy,h=n.assign,o="\r\n",e="Get_Supported_Events",s="Has_Event",a="get_supported_events",u="has_event",_="get_simple_caller_of_event",t="trivial_clone",l="default_info",c="default_security_level",g="sstp_version_table",f="substring",v="length",p="entries",d="proxy",w="then",m="",y=(t,e)=>{var s=t.indexOf(e);return[t[f](0,s),t[f](s+e[v])]},b=r=>(t,e)=>{var s;if(!r.t||!r.t(t,e))return(s=n(e)instanceof String?r.i&&r.i(t,e):r.h&&r.h(t,e))!==i?s:r.u?r.u(t,e):(s=t[e])instanceof Function?s.bind(t):s},S=!!globalThis.window,x=t=>"http://localhost:"+(t??9801),E=S?location.origin:x(process.env.PORT),O=/^\w+:\/\/localhost/.test(E)?"local":"external";class T{get keys(){return n.keys(this)}get values(){return n.values(this)}get[p](){return n[p](this)}get[v](){return this.keys[v]}forEach(s){return this[p].forEach(([t,e])=>{this[t]=s(e,t)??e})}get[t](){return h(N(),this)}flat_map(s){let r=[];return this[p].map(([t,e])=>r.push(...e instanceof T?e.flat_map(s.bind(s,t)):[s(t,e)])),r}map(s){return this[p].map(([t,e])=>s(e,t))}push(t){return t.forEach(t=>t?this[t[0]]=t[1]:i),this}}var N=()=>new T;class P extends T{#t;#h;constructor(t,e,s={}){super(),this.#t=m+t,s[v]&&(this.#h=s),h(this,e)}get unknown_lines(){return this.#h||[]}get head(){return this.#t}toString(){return[this.#t,...this.unknown_lines,...this[p].map(([t,e])=>t+": "+e),m,m].join(o)}to_string(){return m+this}toJSON(){return{head:this.#t,unknown_lines:this.#h,body:this[t]}}get status_code(){return+this.#t.split(" ").find(t=>(t=+t)==t)}}var C="X-SSTP-PassThru-";class j extends P{constructor(t,e,s={}){return super(t,e,s),new r(this,{get:b({i:(t,e)=>C+e in t?t.get_passthrough(e):i})})}static from_string(t){let e,[s,...r]=t.split(o),i={},n=[];r[v]-=2;for(var h of r){var[a,u]=y(h,": ");/^\w[^\s]*$/.test(a)?i[e=a]=u:e?i[e]+=o+h:n.push(h)}return new j(s,i,n)}get_passthrough(t){return this[C+t]}#u;get passthroughs(){return this.#u??=N().push(this.map((t,e)=>e.startsWith(C)?[e.slice(16),t]:i))}get raw(){return this}}class k extends P{constructor(t){var e,s,r,i,[t,...n]=t.split(o);super(t,{});for(e of n)e&&([r,s]=y(e,""),[r,i]=y(r,"."),(this[r]||=N())[i]=s)}get_uuid_by(e,s){return this.uuids.find(t=>this[t][e]==s)}get_list_of(e){return this.uuids.map(t=>this[t][e])}get uuids(){return this.keys}get available(){return!!this[v]}toString(){return[this.head,m,...this.flat_map((t,e,s)=>t+"."+e+""+s),m,m].join(o)}toJSON(){return{head:this.head,fmo_infos:this[t]}}}class q{#o;#_;#l;#g;#v;constructor(t){this.#o=t,this[c]=t[c]}async check_event(t,e=this[c]){return this.#l?this.#g[e].includes(t):!!this.#_&&(this.#v[e][t]??=await this.#o[u](t))}get available(){return this.#_}get fast_query_available(){return this.#l}reset(){return this.clear(),this.init()}async init(){var t=this.#o;return this.#_=await t[u](s),this.#l=this.#_&&await t[u](e),this.#l&&(this.#g=await t[a]()),this}clear(){this.#_=this.#l=!1,this.#v={local:{},external:{}}}}var F="SEND";class G{#p;constructor(t,e){return this.RequestHeader={Origin:E},this[l]={Charset:"UTF-8"},this.host=e,this.sendername=t,this[g]={SEND:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},this[c]=O,this[d]=new r(this,{get:b({i:(t,e)=>e in t[g]?t.get_caller_of_method(e):/^On/.test(e)?t[_]("_"==(t=e)[2]?t[f](3):t):i})})}set host(t){this.#p=t||x()+"/api/sstp/v1"}get host(){return this.#p}set sendername(t){this[l].Sender=t||"jsstp-client"}get sendername(){return this[l].Sender}row_send(t){return new Promise((e,s)=>fetch(this.#p,{method:"POST",headers:this.RequestHeader,body:m+t})[w](t=>200!=t.status?s(t.status):t.text()[w](e)).catch(s))}costom_text_send(t,e){return this.row_send(new j(t,{...this[l],...e}))}costom_send(t,e){return this.costom_text_send(t,e)[w](t=>j.from_string(t))}get_caller_of_method(t){let e=t+" SSTP/"+this[g][t];return h(t=>this.costom_send(e,t),{get_raw:t=>this.costom_text_send(e,t)})}get_caller_of_event(e,s=F){return t=>this[d][s](h({Event:e},t))}[_](r,i=F){return(...t)=>{let e=0,s={};return t.forEach(t=>s["Reference"+e++]=t),this.get_caller_of_event(r,i)(s)}}get event(){return new r({},{get:(t,e)=>this[_](e)})}[u](t,e=this[c]){return this.event[s](t,e)[w](({Result:t})=>1==t)}[a](){return this.event[e]()[w](({local:t,external:e})=>({local:(t||m).split(","),external:(e||m).split(",")}))}get_fmo_infos(){return this[d].EXECUTE.get_raw({Command:"GetFMO"})[w](t=>new k(t))}available(){return this.get_fmo_infos()[w](t=>t.available).catch(()=>!1)}new_event_queryer(){return new q(this).init()}}h(G.prototype,{type:G,base_sstp_info_t:P,sstp_info_t:j,fmo_info_t:k,ghost_events_queryer_t:q}),S=new G;export{P as base_sstp_info_t,S as default,k as fmo_info_t,q as ghost_events_queryer_t,S as jsstp,G as jsstp_t,j as sstp_info_t}
