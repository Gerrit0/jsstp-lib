var i,t=t=>t.toLowerCase(),o=(t,s)=>{var e=t.indexOf(s);return[t[p](0,e),t[p](e+s[v])]},M=r=>(t,s)=>{var e;if(!r.t||!r.t(t,s))return(e=n(s)instanceof String?r.i&&r.i(t,s):r.h&&r.h(t,s))!==i?e:r.u?r.u(t,s):(e=t[s])instanceof Function?e.bind(t):e},U=!!globalThis.window,D=t=>"http://localhost:"+(t??9801),J=U?location.origin:D(process.env.PORT),R=/^\w+:\/\/localhost/.test(J)?x:N,n=Object,h=Proxy,r=n.assign,_="\r\n",s="Get_Supported_Events",e="Has_Event",X=t(s),u=t(e),a="get_simple_caller_of_event",l="trivial_clone",c="default_info",g="default_security_level",f="sstp_version_table",p="substring",v="length",d="available",w="split",m="entries",y="costom_text_send",S="forEach",A="get_caller_of_method",H="unknown_lines",b="get_caller_of_event",E="sendername",O="proxy",T="then",x="local",N="external",P="";class C{get keys(){return n.keys(this)}get values(){return n.values(this)}get[m](){return n[m](this)}get[v](){return this.keys[v]}[S](e){return this[m][S](([t,s])=>{this[t]=e(s,t)??s})}get[l](){return r(j(),this)}flat_map(e){let r=[];return this[m].map(([t,s])=>r.push(...s instanceof C?s.flat_map(e.bind(e,t)):[e(t,s)])),r}map(e){return this[m].map(([t,s])=>e(s,t))}push(t){return t[S](t=>t?this[t[0]]=t[1]:i),this}}var j=()=>new C;class k extends C{#t;#h;constructor(t,s,e={}){super(),this.#t=P+t,e[v]&&(this.#h=e),r(this,s)}get[H](){return this.#h||[]}get head(){return this.#t}toString(){return[this.#t,...this[H],...this[m].map(([t,s])=>t+": "+s),P,P].join(_)}to_string(){return P+this}toJSON(){return{head:this.#t,unknown_lines:this.#h,body:this[l]}}get status_code(){return+this.#t[w](" ").find(t=>(t=+t)==t)}}var q="X-SSTP-PassThru-";class F extends k{constructor(t,s,e={}){return super(t,s,e),new h(this,{get:M({i:(t,s)=>q+s in t?t.get_passthrough(s):i})})}static from_string(t){let s,[e,...r]=t[w](_),i={},n=[];r[v]-=2;for(var h of r){var[u,a]=o(h,": ");/^\w[^\s]*$/.test(u)?i[s=u]=a:s?i[s]+=_+h:n.push(h)}return new F(e,i,n)}get_passthrough(t){return this[q+t]}#u;get passthroughs(){return this.#u??=j().push(this.map((t,s)=>s.startsWith(q)?[s.slice(16),t]:i))}get raw(){return this}}class G extends k{constructor(t){var s,e,r,i,[t,...n]=t[w](_);super(t,{});for(s of n)s&&([r,e]=o(s,""),[r,i]=o(r,"."),(this[r]||=j())[i]=e)}get_uuid_by(s,e){return this.uuids.find(t=>this[t][s]==e)}get_list_of(s){return this.uuids.map(t=>this[t][s])}get uuids(){return this.keys}get[d](){return!!this[v]}toString(){return[this.head,P,...this.flat_map((t,s,e)=>t+"."+s+""+e),P,P].join(_)}toJSON(){return{head:this.head,fmo_infos:this[l]}}}class V{#o;#_;#l;#g;#p;constructor(t){this.#o=t,this[g]=t[g]}async check_event(t,s=this[g]){return this.#l?this.#g[s].includes(t):!!this.#_&&(this.#p[s][t]??=await this.#o[u](t))}get[d](){return this.#_}get fast_query_available(){return this.#l}reset(){return this.clear(),this.init()}async init(){var t=this.#o;return this.#_=await t[u](e),this.#l=this.#_&&await t[u](s),this.#l&&(this.#g=await t[X]()),this}clear(){this.#_=this.#l=!1,this.#p={[x]:{},[N]:{}}}}var Y="SEND";class I{#v;constructor(t,s){return this.RequestHeader={Origin:J},this[c]={Charset:"UTF-8"},this.host=s,this[E]=t,this[f]={SEND:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},this[g]=R,this[O]=new h(this,{get:M({i:(t,s)=>s in t[f]?t[A](s):/^On/.test(s)?t[a]("_"==(t=s)[2]?t[p](3):t):i})})}set host(t){this.#v=t||D()+"/api/sstp/v1"}get host(){return this.#v}set[E](t){this[c].Sender=t||"jsstp-client"}get[E](){return this[c].Sender}row_send(t){return new Promise((s,e)=>fetch(this.#v,{method:"POST",headers:this.RequestHeader,body:P+t})[T](t=>200!=t.status?e(t.status):t.text()[T](s)).catch(e))}[y](t,s){return this.row_send(new F(t,{...this[c],...s}))}costom_send(t,s){return this[y](t,s)[T](t=>F.from_string(t))}[A](t){let s=t+" SSTP/"+this[f][t];return r(t=>this.costom_send(s,t),{get_raw:t=>this[y](s,t)})}#m(r,e,i,n){return new h(i,{get:(t,s)=>s in t?t[s]:s==T?(s,e)=>this[u](r).then(t=>t?s(i):e(!1)).catch(e):this[n](r+"."+s,e)})}[b](s,e=Y){return this.#m(s,e,t=>this[O][e](r({Event:s},t)),b)}[a](r,i=Y){return this.#m(r,i,(...t)=>{let s=0,e={};return t[S](t=>e["Reference"+s++]=t),this[b](r,i)(e)},a)}get event(){return new h({},{get:(t,s)=>this[a](s)})}[u](t,s=this[g]){return this.event[e](t,s)[T](({Result:t})=>1==t)}[X](){return this.event[s]()[T](({[x]:t,[N]:s})=>({[x]:(t||P)[w](","),[N]:(s||P)[w](",")}))}get_fmo_infos(){return this[O].EXECUTE.get_raw({Command:"GetFMO"})[T](t=>new G(t))}[d](){return this.get_fmo_infos()[T](t=>t[d]).catch(()=>!1)}[T](s,e){return this[d]()[T](t=>t?s(this):e())}new_event_queryer(){return new V(this).init()}}r(I.prototype,{type:I,base_sstp_info_t:k,sstp_info_t:F,fmo_info_t:G,ghost_events_queryer_t:V}),t=new I;export{k as base_sstp_info_t,t as default,G as fmo_info_t,V as ghost_events_queryer_t,t as jsstp,I as jsstp_t,F as sstp_info_t}
