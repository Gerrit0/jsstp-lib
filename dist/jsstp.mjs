var i,o=(t,s)=>{var e=t.indexOf(s);return[t[v](0,e),t[v](e+s[d])]},r=r=>(t,s)=>{var e;if(!r.t||!r.t(t,s))return(e=n(s)instanceof String?r.i&&r.i(t,s):r.h&&r.h(t,s))!==i?e:r.u?r.u(t,s):(e=t[s])instanceof Function?e.bind(t):e},t=!!globalThis.window,s=t=>"http://localhost:"+(t??9801),e=t?location.origin:s(process.env.PORT),M=/^\w+:\/\/localhost/.test(e)?T:x,n=Object,h=Proxy,a=n.assign,_="\r\n",U="Get_Supported_Events",D="Has_Event",J="get_supported_events",u="has_event",l="get_simple_caller_of_event",c="trivial_clone",g="default_info",f="default_security_level",p="sstp_version_table",v="substring",d="length",w="available",m="split",y="entries",S="costom_text_send",b="forEach",E="proxy",O="then",T="local",x="external",N="";class P{get keys(){return n.keys(this)}get values(){return n.values(this)}get[y](){return n[y](this)}get[d](){return this.keys[d]}[b](e){return this[y][b](([t,s])=>{this[t]=e(s,t)??s})}get[c](){return a(C(),this)}flat_map(e){let r=[];return this[y].map(([t,s])=>r.push(...s instanceof P?s.flat_map(e.bind(e,t)):[e(t,s)])),r}map(e){return this[y].map(([t,s])=>e(s,t))}push(t){return t[b](t=>t?this[t[0]]=t[1]:i),this}}var C=()=>new P;class j extends P{#t;#h;constructor(t,s,e={}){super(),this.#t=N+t,e[d]&&(this.#h=e),a(this,s)}get unknown_lines(){return this.#h||[]}get head(){return this.#t}toString(){return[this.#t,...this.unknown_lines,...this[y].map(([t,s])=>t+": "+s),N,N].join(_)}to_string(){return N+this}toJSON(){return{head:this.#t,unknown_lines:this.#h,body:this[c]}}get status_code(){return+this.#t[m](" ").find(t=>(t=+t)==t)}}var k="X-SSTP-PassThru-";class q extends j{constructor(t,s,e={}){return super(t,s,e),new h(this,{get:r({i:(t,s)=>k+s in t?t.get_passthrough(s):i})})}static from_string(t){let s,[e,...r]=t[m](_),i={},n=[];r[d]-=2;for(var h of r){var[a,u]=o(h,": ");/^\w[^\s]*$/.test(a)?i[s=a]=u:s?i[s]+=_+h:n.push(h)}return new q(e,i,n)}get_passthrough(t){return this[k+t]}#u;get passthroughs(){return this.#u??=C().push(this.map((t,s)=>s.startsWith(k)?[s.slice(16),t]:i))}get raw(){return this}}class F extends j{constructor(t){var s,e,r,i,[t,...n]=t[m](_);super(t,{});for(s of n)s&&([r,e]=o(s,""),[r,i]=o(r,"."),(this[r]||=C())[i]=e)}get_uuid_by(s,e){return this.uuids.find(t=>this[t][s]==e)}get_list_of(s){return this.uuids.map(t=>this[t][s])}get uuids(){return this.keys}get[w](){return!!this[d]}toString(){return[this.head,N,...this.flat_map((t,s,e)=>t+"."+s+""+e),N,N].join(_)}toJSON(){return{head:this.head,fmo_infos:this[c]}}}class G{#o;#_;#l;#g;#p;constructor(t){this.#o=t,this[f]=t[f]}async check_event(t,s=this[f]){return this.#l?this.#g[s].includes(t):!!this.#_&&(this.#p[s][t]??=await this.#o[u](t))}get[w](){return this.#_}get fast_query_available(){return this.#l}reset(){return this.clear(),this.init()}async init(){var t=this.#o;return this.#_=await t[u](D),this.#l=this.#_&&await t[u](U),this.#l&&(this.#g=await t[J]()),this}clear(){this.#_=this.#l=!1,this.#p={[T]:{},[x]:{}}}}var R="SEND";class I{#v;constructor(t,s){return this.RequestHeader={Origin:e},this[g]={Charset:"UTF-8"},this.host=s,this.sendername=t,this[p]={SEND:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},this[f]=M,this[E]=new h(this,{get:r({i:(t,s)=>s in t[p]?t.get_caller_of_method(s):/^On/.test(s)?t[l]("_"==(t=s)[2]?t[v](3):t):i})})}set host(t){this.#v=t||s()+"/api/sstp/v1"}get host(){return this.#v}set sendername(t){this[g].Sender=t||"jsstp-client"}get sendername(){return this[g].Sender}row_send(t){return new Promise((s,e)=>fetch(this.#v,{method:"POST",headers:this.RequestHeader,body:N+t})[O](t=>200!=t.status?e(t.status):t.text()[O](s)).catch(e))}[S](t,s){return this.row_send(new q(t,{...this[g],...s}))}costom_send(t,s){return this[S](t,s)[O](t=>q.from_string(t))}get_caller_of_method(t){let s=t+" SSTP/"+this[p][t];return a(t=>this.costom_send(s,t),{get_raw:t=>this[S](s,t)})}get_caller_of_event(s,e=R){return t=>this[E][e](a({Event:s},t))}[l](r,i=R){return(...t)=>{let s=0,e={};return t[b](t=>e["Reference"+s++]=t),this.get_caller_of_event(r,i)(e)}}get event(){return new h({},{get:(t,s)=>this[l](s)})}[u](t,s=this[f]){return this.event[D](t,s)[O](({Result:t})=>1==t)}[J](){return this.event[U]()[O](({[T]:t,[x]:s})=>({[T]:(t||N)[m](","),[x]:(s||N)[m](",")}))}get_fmo_infos(){return this[E].EXECUTE.get_raw({Command:"GetFMO"})[O](t=>new F(t))}[w](){return this.get_fmo_infos()[O](t=>t[w]).catch(()=>!1)}new_event_queryer(){return new G(this).init()}}a(I.prototype,{type:I,base_sstp_info_t:j,sstp_info_t:q,fmo_info_t:F,ghost_events_queryer_t:G}),t=new I;export{j as base_sstp_info_t,t as default,F as fmo_info_t,G as ghost_events_queryer_t,t as jsstp,I as jsstp_t,q as sstp_info_t}
