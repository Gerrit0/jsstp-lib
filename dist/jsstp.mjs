var i,G=t=>t.toLowerCase(),o=(t,e)=>{var s=t.indexOf(e);return[t[f](0,s),t[f](s+e[p])]},H=r=>(t,e)=>{var s;if(!r.t||!r.t(t,e))return(s=n(e)instanceof String?r.i&&r.i(t,e):r.h&&r.h(t,e))!==i?s:r.u?r.u(t,e):(s=t[e])instanceof Function?s.bind(t):s},t=!!globalThis.window,I=t=>"http://localhost:"+(t??9801),M=t?location.origin:I(process.env.PORT),X=/^\w+:\/\/localhost/.test(M)?x:k,n=Object,h=Proxy,r=n.assign,_="\r\n",e="Get_Supported_Events",s="Has_Event",D=G(e),a=G(s),u="get_simple_caller_of_event",l="trivial_clone",c="default_info",g="default_security_level",d="sstp_version_table",f="substring",p="length",v="available",w="split",m="entries",y="costom_text_send",S="forEach",J="get_caller_of_method",A="unknown_lines",E="get_caller_of_event",b="sendername",O="proxy",T="then",L="SEND",V="get_fmo_infos",W="get_passthrough",x="local",k="external",C="",P="X-SSTP-PassThru-";class j{get keys(){return n.keys(this)}get values(){return n.values(this)}get[m](){return n[m](this)}get[p](){return this.keys[p]}[S](s){return this[m][S](([t,e])=>{this[t]=s(e,t)??e})}get[l](){return r(q(),this)}flat_map(s){let r=[];return this[m].map(([t,e])=>r.push(...e instanceof j?e.flat_map(s.bind(s,t)):[s(t,e)])),r}map(s){return this[m].map(([t,e])=>s(e,t))}push(t){return t[S](t=>t?this[t[0]]=t[1]:i),this}}var q=()=>new j;class N extends j{#t;#e;constructor(t,e,s={}){super(),this.#t=C+t,s[p]&&(this.#e=s),r(this,e)}get[A](){return this.#e||[]}get head(){return this.#t}toString(){return[this.#t,...this[A],...this[m].map(([t,e])=>t+": "+e),C,C].join(_)}to_string(){return C+this}toJSON(){return{head:this.#t,unknown_lines:this.#e,body:this[l]}}get status_code(){return+this.#t[w](" ").find(t=>{return(t=+t)==t})}}class R extends N{constructor(t,e,s={}){return super(t,e,s),new h(this,{get:H({i:(t,e)=>P+e in t?t[W](e):i})})}static from_string(t){let e,[s,...r]=t[w](_),i={},n=[];r[p]-=2;for(var h of r){var[a,u]=o(h,": ");/^\w[^\s]*$/.test(a)?i[e=a]=u:e?i[e]+=_+h:n.push(h)}return new R(s,i,n)}[W](t){return this[P+t]}#s;get passthroughs(){return this.#s??=q().push(this.map((t,e)=>e.startsWith(P)?[e.slice(16),t]:i))}get raw(){return this}}class F extends N{constructor(t){var e,s,r,i,[t,...n]=t[w](_);super(t,{});for(e of n)e&&([r,s]=o(e,""),[r,i]=o(r,"."),(this[r]||=q())[i]=s)}get_uuid_by(e,s){return this.uuids.find(t=>this[t][e]==s)}get_list_of(e){return this.uuids.map(t=>this[t][e])}get uuids(){return this.keys}get[v](){return!!this[p]}toString(){return[this.head,C,...this.flat_map((t,e,s)=>t+"."+e+""+s),C,C].join(_)}toJSON(){return{head:this.head,fmo_infos:this[l]}}}class Y{#r;#i;#n;#h;#u;constructor(t){this.#r=t,this[g]=t[g]}async check_event(t,e=this[g]){return this.#n?this.#h[e].includes(t):!!this.#i&&(this.#u[e][t]??=await this.#r[a](t))}get[v](){return this.#i}get fast_query_available(){return this.#n}reset(){return this.clear(),this.init()}async init(){var t=this.#r;return this.#i=await t[a](s),this.#n=this.#i&&await t[a](e),this.#n&&(this.#h=await t[D]()),this}clear(){this.#i=this.#n=!1,this.#u={[x]:{},[k]:{}}}}class U{#a;constructor(t,e){return this.RequestHeader={Origin:M},this[c]={Charset:"UTF-8"},this.host=e,this[b]=t,this[d]={SEND:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},this[g]=X,this[O]=new h(this,{get:H({i:(t,e)=>{return e in t[d]?t[J](e):/^On/.test(e)?t[u]("_"==(t=e)[2]?t[f](3):t):i}})})}set host(t){this.#a=t||I()+"/api/sstp/v1"}get host(){return this.#a}set[b](t){this[c].Sender=t||"jsstp-client"}get[b](){return this[c].Sender}row_send(t){return new Promise((e,s)=>{return fetch(this.#a,{method:"POST",headers:this.RequestHeader,body:C+t})[T](t=>200!=t.status?s(t.status):t.text()[T](e),s)})}[y](t,e){return this.row_send(new R(t,{...this[c],...e}))}costom_send(t,e){return this[y](t,e)[T](t=>R.from_string(t))}[J](t){let e=t+" SSTP/"+this[d][t];return r(t=>this.costom_send(e,t),{get_raw:t=>this[y](e,t)})}#o(e,r,t,i){return new h(t,{get:(s,t)=>t in s?s[t]:t==T?(t,e)=>s()[T](t,e):this[i](e+"."+t,r)})}[E](e,s=L){return this.#o(e,s,t=>this[O][s](r({Event:e},t)),E)}[u](r,i=L){return this.#o(r,i,(...t)=>{let e=0,s={};return t[S](t=>s["Reference"+e++]=t),this[E](r,i)(s)},u)}get event(){return new h({},{get:(t,e)=>this[u](e)})}[a](t,e=this[g]){return this.event[s](t,e)[T](({Result:t})=>1==t)}[D](){return this.event[e]()[T](({[x]:t,[k]:e})=>({[x]:(t||C)[w](","),[k]:(e||C)[w](",")}))}[V](){return this[O].EXECUTE.get_raw({Command:"GetFMO"})[T](t=>new F(t))}[v](){return this[V]()[T](t=>t[v],()=>!1)}[T](e,s){return this[v]()[T](t=>t?e(this):s(),s)}new_event_queryer(){return new Y(this).init()}}r(U.prototype,{type:U,base_sstp_info_t:N,sstp_info_t:R,fmo_info_t:F,ghost_events_queryer_t:Y});t=new U;export{N as base_sstp_info_t,t as default,F as fmo_info_t,Y as ghost_events_queryer_t,t as jsstp,U as jsstp_t,R as sstp_info_t}
