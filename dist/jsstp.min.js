var jsstp=(()=>{let t=Object,r=t.assign,o="\r\n",n,e="Get_Supported_Events",s="Has_Event",i="has_event",h="get_simple_caller_of_event",a="trivial_clone",u="default_info",_="substring",[l,c,g,d]=["blocker","string_key_handler","symbol_key_handler","default_handler"],v=(t,e)=>{var s=t.indexOf(e);return[t[_](0,s),t[_](s+e.length)]},f=t=>/^On/.test(t),p=t=>"_"==t[2]?t[_](3):t,y=t=>t==t,w=r=>(e,s)=>{if(!r[l]||!r[l](e,s)){let t;return(t=Object(s)instanceof String?r[c]&&r[c](e,s):r[g]&&r[g](e,s))!==n?t:r[d]?r[d](e,s):(t=e[s])instanceof Function?t.bind(e):t}};var m=!!globalThis.window;let b=t=>"http://localhost:"+(t??9801),S=m?location.origin:b(process.env.PORT),x=/^\w+:\/\/localhost/.test(S)?"local":"external";class E{get keys(){return t.keys(this)}get values(){return t.values(this)}get entries(){return t.entries(this)}get length(){return this.keys.length}forEach(s){return this.entries.forEach(([t,e])=>{this[t]=s(e,t)||e})}get trivial_clone(){return r(k(),this)}flat_map(s){let r=[];return this.entries.map(([t,e])=>{e instanceof E?r.push(...e.flat_map(s.bind(s,t))):r.push(s(t,e))}),r}map(s){return this.entries.map(([t,e])=>s(e,t))}push(t){return t.forEach(t=>t?this[t[0]]=t[1]:n),this}}let k=()=>new E;class O extends E{#t;#i;constructor(t,e,s={}){super(),this.#t=""+t,s.length&&(this.#i=s),r(this,e)}get unknown_lines(){return this.#i||[]}get head(){return this.#t}toString(){return[this.#t,...this.unknown_lines,...this.entries.map(([t,e])=>t+": "+e),"",""].join(o)}to_string(){return this.toString()}toJSON(){return{head:this.#t,unknown_lines:this.#i,body:this[a]}}get status_code(){return+this.#t.split(" ").find(t=>y(+t))}}let T="X-SSTP-PassThru-";class P extends O{constructor(t,e,s={}){return super(t,e,s),new Proxy(this,{get:w({string_key_handler:(t,e)=>T+e in t?t.get_passthrough(e):n})})}static from_string(t){var e,[t,...s]=t.split(o),r={},n=[];let i;s.length-=2;for(e of s){var[h,a]=v(e,": ");/^\w[^\s]*$/.test(h)?r[i=h]=a:i?r[i]+=o+e:n.push(e)}return new P(t,r,n)}get_passthrough(t){return this[T+t]}#h;get passthroughs(){return this.#h??=k().push(this.map((t,e)=>e.startsWith(T)?[e.slice(16),t]:n))}get raw(){return this}}class N extends O{constructor(t){var e,s,r,n,[t,...i]=t.split(o);super(t,{});for(e of i)e&&([r,s]=v(e,""),[r,n]=v(r,"."),this[r]||=k(),this[r][n]=s)}get_uuid_by(e,s){return this.uuids.find(t=>this[t][e]==s)}get_list_of(e){return this.uuids.map(t=>this[t][e])}get uuids(){return this.keys}get available(){return!!this.length}toString(){return[this.head,"",...this.flat_map((t,e,s)=>t+"."+e+""+s),"",""].join(o)}toJSON(){return{head:this.head,fmo_infos:this[a]}}}class C{#o;#u;#_;#l;#g;constructor(t){this.#o=t}async check_event(t,e=x){return this.#_?this.#l[e].includes(t):!!this.#u&&(this.#g[e][t]??=await this.#o[i](t))}get available(){return this.#u}get fast_query_available(){return this.#_}async reset(){this.clear();var t=this.#o;return this.#u=await t[i](s),this.#_=this.#u&&await t[i](e),this.#_&&(this.#l=await t.get_supported_events()),this}async init(){return this.reset()}clear(){this.#u=this.#_=!1,this.#g={local:{},external:{}}}}let j={SEND:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},q=t=>t+" SSTP/"+j[t];class F{#v;proxy;RequestHeader;default_info;static sstp_version_table=j;static default_security_level=x;constructor(t,e){return this.RequestHeader={"Content-Type":"text/plain",Origin:S},this[u]={Charset:"UTF-8"},this.host=e,this.sendername=t,this.proxy=new Proxy(this,{get:w({string_key_handler:(t,e)=>e in j?t.get_caller_of_method(e):f(e)?t[h](p(e)):void 0})}),this.proxy}set host(t){this.#v=t||b()+"/api/sstp/v1"}get host(){return this.#v}set sendername(t){this[u].Sender=t||"jsstp-client"}get sendername(){return this[u].Sender}row_send(t){return new Promise((e,s)=>fetch(this.host,{method:"POST",headers:this.RequestHeader,body:""+t}).then(t=>200!=t.status?s(t.status):t.text().then(e)).catch(s))}costom_text_send(t,e){return this.row_send(new P(t,{...this.default_info,...e}))}async costom_send(t,e){return this.costom_text_send(t,e).then(t=>P.from_string(t))}get_caller_of_method(t){let e=q(t);return r(t=>this.costom_send(e,t),{get_raw:t=>this.costom_text_send(e,t)})}get_caller_of_event(e,s="SEND"){return t=>this.proxy[s](r({Event:e},t))}get_simple_caller_of_event(r,n="SEND"){return(...t)=>{let e=0,s={};return t.forEach(t=>s["Reference"+e++]=t),this.get_caller_of_event(r,n)(s)}}get event(){return new Proxy({},{get:(t,e)=>this[h](e)})}async has_event(t,e=x){return this.event[s](t,e).then(({Result:t})=>"1"==t)}async get_supported_events(){return this.event[e]().then(({local:t,external:e})=>({local:(t||"").split(","),external:(e||"").split(",")}))}async get_fmo_infos(){return this.proxy.EXECUTE.get_raw({Command:"GetFMO"}).then(t=>new N(t))}async available(){return this.get_fmo_infos().then(t=>t.available).catch(()=>!1)}async new_event_queryer(){return new C(this).init()}}return r(F.prototype,{type:F,base_sstp_info_t:O,sstp_info_t:P,fmo_info_t:N,ghost_events_queryer_t:C}),new F})()
