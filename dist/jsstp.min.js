var jsstp=(()=>{var i,t=t=>t.toLowerCase(),o=(t,s)=>{var e=t.indexOf(s);return[t[p](0,e),t[p](e+s[w])]},r=r=>(t,s)=>{var e;if(!r.t||!r.t(t,s))return(e=n(s)instanceof String?r.i&&r.i(t,s):r.h&&r.h(t,s))!==i?e:r.u?r.u(t,s):(e=t[s])instanceof Function?e.bind(t):e},M=!!globalThis.window,U=t=>"http://localhost:"+(t??9801),D=M?location.origin:U(process.env.PORT),J=/^\w+:\/\/localhost/.test(D)?N:P,n=Object,h=Proxy,u=n.assign,_="\r\n",s="Get_Supported_Events",e="Has_Event",R=t(s),a=t(e),l="get_simple_caller_of_event",c="trivial_clone",g="default_info",f="default_security_level",v="sstp_version_table",p="substring",w="length",d="available",m="split",y="entries",S="costom_text_send",E="forEach",X="get_caller_of_method",A="unknown_lines",b="get_caller_of_event",O="sendername",T="proxy",x="then",N="local",P="external",C="";class k{get keys(){return n.keys(this)}get values(){return n.values(this)}get[y](){return n[y](this)}get[w](){return this.keys[w]}[E](e){return this[y][E](([t,s])=>{this[t]=e(s,t)??s})}get[c](){return u(F(),this)}flat_map(e){let r=[];return this[y].map(([t,s])=>r.push(...s instanceof k?s.flat_map(e.bind(e,t)):[e(t,s)])),r}map(e){return this[y].map(([t,s])=>e(s,t))}push(t){return t[E](t=>t?this[t[0]]=t[1]:i),this}}var F=()=>new k;class j extends k{#t;#h;constructor(t,s,e={}){super(),this.#t=C+t,e[w]&&(this.#h=e),u(this,s)}get[A](){return this.#h||[]}get head(){return this.#t}toString(){return[this.#t,...this[A],...this[y].map(([t,s])=>t+": "+s),C,C].join(_)}to_string(){return C+this}toJSON(){return{head:this.#t,unknown_lines:this.#h,body:this[c]}}get status_code(){return+this.#t[m](" ").find(t=>(t=+t)==t)}}var q="X-SSTP-PassThru-";class G extends j{constructor(t,s,e={}){return super(t,s,e),new h(this,{get:r({i:(t,s)=>q+s in t?t.get_passthrough(s):i})})}static from_string(t){let s,[e,...r]=t[m](_),i={},n=[];r[w]-=2;for(var h of r){var[u,a]=o(h,": ");/^\w[^\s]*$/.test(u)?i[s=u]=a:s?i[s]+=_+h:n.push(h)}return new G(e,i,n)}get_passthrough(t){return this[q+t]}#u;get passthroughs(){return this.#u??=F().push(this.map((t,s)=>s.startsWith(q)?[s.slice(16),t]:i))}get raw(){return this}}class H extends j{constructor(t){var s,e,r,i,[t,...n]=t[m](_);super(t,{});for(s of n)s&&([r,e]=o(s,""),[r,i]=o(r,"."),(this[r]||=F())[i]=e)}get_uuid_by(s,e){return this.uuids.find(t=>this[t][s]==e)}get_list_of(s){return this.uuids.map(t=>this[t][s])}get uuids(){return this.keys}get[d](){return!!this[w]}toString(){return[this.head,C,...this.flat_map((t,s,e)=>t+"."+s+""+e),C,C].join(_)}toJSON(){return{head:this.head,fmo_infos:this[c]}}}class V{#o;#_;#l;#g;#v;constructor(t){this.#o=t,this[f]=t[f]}async check_event(t,s=this[f]){return this.#l?this.#g[s].includes(t):!!this.#_&&(this.#v[s][t]??=await this.#o[a](t))}get[d](){return this.#_}get fast_query_available(){return this.#l}reset(){return this.clear(),this.init()}async init(){var t=this.#o;return this.#_=await t[a](e),this.#l=this.#_&&await t[a](s),this.#l&&(this.#g=await t[R]()),this}clear(){this.#_=this.#l=!1,this.#v={[N]:{},[P]:{}}}}var Y="SEND";class I{#p;constructor(t,s){return this.RequestHeader={Origin:D},this[g]={Charset:"UTF-8"},this.host=s,this[O]=t,this[v]={SEND:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},this[f]=J,this[T]=new h(this,{get:r({i:(t,s)=>s in t[v]?t[X](s):/^On/.test(s)?t[l]("_"==(t=s)[2]?t[p](3):t):i})})}set host(t){this.#p=t||U()+"/api/sstp/v1"}get host(){return this.#p}set[O](t){this[g].Sender=t||"jsstp-client"}get[O](){return this[g].Sender}row_send(t){return new Promise((s,e)=>fetch(this.#p,{method:"POST",headers:this.RequestHeader,body:C+t})[x](t=>200!=t.status?e(t.status):t.text()[x](s)).catch(e))}[S](t,s){return this.row_send(new G(t,{...this[g],...s}))}costom_send(t,s){return this[S](t,s)[x](t=>G.from_string(t))}[X](t){let s=t+" SSTP/"+this[v][t];return u(t=>this.costom_send(s,t),{get_raw:t=>this[S](s,t)})}#m(r,e,i,n){return new h(i,{get:(t,s)=>s in t?t[s]:s==x?(s,e)=>this[a](r).then(t=>t?s(i):e(!1)).catch(e):this[n](r+"."+s,e)})}[b](s,e=Y){return this.#m(s,e,t=>this[T][e](u({Event:s},t)),b)}[l](r,i=Y){return this.#m(r,i,(...t)=>{let s=0,e={};return t[E](t=>e["Reference"+s++]=t),this[b](r,i)(e)},l)}get event(){return new h({},{get:(t,s)=>this[l](s)})}[a](t,s=this[f]){return this.event[e](t,s)[x](({Result:t})=>1==t)}[R](){return this.event[s]()[x](({[N]:t,[P]:s})=>({[N]:(t||C)[m](","),[P]:(s||C)[m](",")}))}get_fmo_infos(){return this[T].EXECUTE.get_raw({Command:"GetFMO"})[x](t=>new H(t))}[d](){return this.get_fmo_infos()[x](t=>t[d]).catch(()=>!1)}[x](s,e){return this[d]()[x](t=>t?s(this):e())}new_event_queryer(){return new V(this).init()}}return u(I.prototype,{type:I,base_sstp_info_t:j,sstp_info_t:G,fmo_info_t:H,ghost_events_queryer_t:V}),new I})()
