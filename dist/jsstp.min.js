var jsstp=(()=>{var i,t=t=>t.toLowerCase(),o=(t,e)=>{var s=t.indexOf(e);return[t[p](0,s),t[p](s+e[v])]},r=r=>(t,e)=>{var s;if(!r.t||!r.t(t,e))return(s=n(e)instanceof String?r.i&&r.i(t,e):r.h&&r.h(t,e))!==i?s:r.u?r.u(t,e):(s=t[e])instanceof Function?s.bind(t):s},G=!!globalThis.window,H=t=>"http://localhost:"+(t??9801),I=G?location.origin:H(process.env.PORT),M=/^\w+:\/\/localhost/.test(I)?k:C,n=Object,h=Proxy,u=n.assign,_="\r\n",e="Get_Supported_Events",s="Has_Event",X=t(e),a=t(s),l="get_simple_caller_of_event",c="trivial_clone",g="default_info",d="default_security_level",f="sstp_version_table",p="substring",v="length",w="available",m="split",y="entries",S="costom_text_send",E="forEach",D="get_caller_of_method",J="unknown_lines",b="get_caller_of_event",O="sendername",T="proxy",x="then",A="SEND",L="get_fmo_infos",V="get_passthrough",k="local",C="external",P="",N="X-SSTP-PassThru-";class j{get keys(){return n.keys(this)}get values(){return n.values(this)}get[y](){return n[y](this)}get[v](){return this.keys[v]}[E](s){return this[y][E](([t,e])=>{this[t]=s(e,t)??e})}get[c](){return u(q(),this)}flat_map(s){let r=[];return this[y].map(([t,e])=>r.push(...e instanceof j?e.flat_map(s.bind(s,t)):[s(t,e)])),r}map(s){return this[y].map(([t,e])=>s(e,t))}push(t){return t[E](t=>t?this[t[0]]=t[1]:i),this}}var q=()=>new j;class R extends j{#t;#e;constructor(t,e,s={}){super(),this.#t=P+t,s[v]&&(this.#e=s),u(this,e)}get[J](){return this.#e||[]}get head(){return this.#t}toString(){return[this.#t,...this[J],...this[y].map(([t,e])=>t+": "+e),P,P].join(_)}to_string(){return P+this}toJSON(){return{head:this.#t,unknown_lines:this.#e,body:this[c]}}get status_code(){return+this.#t[m](" ").find(t=>{return(t=+t)==t})}}class F extends R{constructor(t,e,s={}){return super(t,e,s),new h(this,{get:r({i:(t,e)=>N+e in t?t[V](e):i})})}static from_string(t){let e,[s,...r]=t[m](_),i={},n=[];r[v]-=2;for(var h of r){var[u,a]=o(h,": ");/^\w[^\s]*$/.test(u)?i[e=u]=a:e?i[e]+=_+h:n.push(h)}return new F(s,i,n)}[V](t){return this[N+t]}#s;get passthroughs(){return this.#s??=q().push(this.map((t,e)=>e.startsWith(N)?[e.slice(16),t]:i))}get raw(){return this}}class W extends R{constructor(t){var e,s,r,i,[t,...n]=t[m](_);super(t,{});for(e of n)e&&([r,s]=o(e,""),[r,i]=o(r,"."),(this[r]||=q())[i]=s)}get_uuid_by(e,s){return this.uuids.find(t=>this[t][e]==s)}get_list_of(e){return this.uuids.map(t=>this[t][e])}get uuids(){return this.keys}get[w](){return!!this[v]}toString(){return[this.head,P,...this.flat_map((t,e,s)=>t+"."+e+""+s),P,P].join(_)}toJSON(){return{head:this.head,fmo_infos:this[c]}}}class Y{#r;#i;#n;#h;#u;constructor(t){this.#r=t,this[d]=t[d]}async check_event(t,e=this[d]){return this.#n?this.#h[e].includes(t):!!this.#i&&(this.#u[e][t]??=await this.#r[a](t))}get[w](){return this.#i}get fast_query_available(){return this.#n}reset(){return this.clear(),this.init()}async init(){var t=this.#r;return this.#i=await t[a](s),this.#n=this.#i&&await t[a](e),this.#n&&(this.#h=await t[X]()),this}clear(){this.#i=this.#n=!1,this.#u={[k]:{},[C]:{}}}}class U{#o;constructor(t,e){return this.RequestHeader={Origin:I},this[g]={Charset:"UTF-8"},this.host=e,this[O]=t,this[f]={SEND:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},this[d]=M,this[T]=new h(this,{get:r({i:(t,e)=>{return e in t[f]?t[D](e):/^On/.test(e)?t[l]("_"==(t=e)[2]?t[p](3):t):i}})})}set host(t){this.#o=t||H()+"/api/sstp/v1"}get host(){return this.#o}set[O](t){this[g].Sender=t||"jsstp-client"}get[O](){return this[g].Sender}row_send(t){return new Promise((e,s)=>{return fetch(this.#o,{method:"POST",headers:this.RequestHeader,body:P+t})[x](t=>200!=t.status?s(t.status):t.text()[x](e),s)})}[S](t,e){return this.row_send(new F(t,{...this[g],...e}))}costom_send(t,e){return this[S](t,e)[x](t=>F.from_string(t))}[D](t){let e=t+" SSTP/"+this[f][t];return u(t=>this.costom_send(e,t),{get_raw:t=>this[S](e,t)})}#a(e,r,t,i){return new h(t,{get:(s,t)=>t in s?s[t]:t==x?(t,e)=>s()[x](t,e):this[i](e+"."+t,r)})}[b](e,s=A){return this.#a(e,s,t=>this[T][s](u({Event:e},t)),b)}[l](r,i=A){return this.#a(r,i,(...t)=>{let e=0,s={};return t[E](t=>s["Reference"+e++]=t),this[b](r,i)(s)},l)}get event(){return new h({},{get:(t,e)=>this[l](e)})}[a](t,e=this[d]){return this.event[s](t,e)[x](({Result:t})=>1==t)}[X](){return this.event[e]()[x](({[k]:t,[C]:e})=>({[k]:(t||P)[m](","),[C]:(e||P)[m](",")}))}[L](){return this[T].EXECUTE.get_raw({Command:"GetFMO"})[x](t=>new W(t))}[w](){return this[L]()[x](t=>t[w],()=>!1)}[x](e,s){return this[w]()[x](t=>t?e(this):s(),s)}new_event_queryer(){return new Y(this).init()}}return u(U.prototype,{type:U,base_sstp_info_t:R,sstp_info_t:F,fmo_info_t:W,ghost_events_queryer_t:Y}),new U})()
