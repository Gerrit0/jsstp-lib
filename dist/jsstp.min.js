var jsstp=(()=>{var t=t=>t.toLowerCase(),e=(t,e)=>{var s=t.indexOf(e);return[t[b](0,s),t[b](s+e[E])]},s=t=>(e,s)=>{var r;if(!t.t||!t.t(e,s))return(r=a(s)instanceof String?t.i&&t.i(e,s):t.h&&t.h(e,s))!==n?r:t.u?t.u(e,s):(r=e[s])instanceof Function?r.bind(e):r};class r extends Function{constructor(t){return a.setPrototypeOf(t,new.target.prototype)}}var n,i=!!globalThis.window,h=t=>"http://localhost:"+(t??9801),u=i?location.origin:h(process.env.PORT),o=/^\w+:\/\/localhost/.test(u)?U:J,a=Object,_=Proxy,l=a.assign,c="\r\n",g="Get_Supported_Events",f="Has_Event",p=t(g),d=t(f),v="get_simple_caller_of_event",w="trivial_clone",m="default_info",y="default_security_level",S="sstp_version_table",b="substring",E="length",x="available",O="split",T="entries",k="costom_text_send",P="forEach",C="get_caller_of_method",F="unknown_lines",N="get_caller_of_event",$="sendername",j="proxy",q="then",G="SEND",I="get_fmo_infos",M="get_passthrough",U="local",J="external",R="",A="X-SSTP-PassThru-";class D{get keys(){return a.keys(this)}get values(){return a.values(this)}get[T](){return a[T](this)}get[E](){return this.keys[E]}[P](t){this[T][P](([e,s])=>{this[e]=t(s,e)??s})}get[w](){return l(H(),this)}flat_map(t){let e=[];return this[T].map(([s,r])=>e.push(...r instanceof D?r.flat_map(t.bind(t,s)):[t(s,r)])),e}map(t){return this[T].map(([e,s])=>t(s,e))}push(t){return t[P](t=>t?this[t[0]]=t[1]:n),this}}var H=()=>new D;class V extends D{#t;#e;constructor(t,e,s={}){super(),this.#t=R+t,s[E]&&(this.#e=s),l(this,e)}get[F](){return this.#e||[]}get head(){return this.#t}toString(){return[this.#t,...this[F],...this[T].map(([t,e])=>t+": "+e),R,R].join(c)}to_string(){return R+this}toJSON(){return{head:this.#t,[F]:this.#e,body:this[w]}}get status_code(){return+this.#t[O](" ").find(t=>{return(t=+t)==t})}}class Y extends V{constructor(t,e,r={}){return super(t,e,r),new _(this,{get:s({i:(t,e)=>A+e in t?t[M](e):n})})}static from_string(t){let s,[r,...n]=t[O](c),i={},h=[];n[E]-=2;for(let t of n){let[r,n]=e(t,": ");/^\w[^\s]*$/.test(r)?i[s=r]=n:s?i[s]+=c+t:h.push(t)}return new Y(r,i,h)}[M](t){return this[A+t]}#s;get passthroughs(){return this.#s??=H().push(this.map((t,e)=>e.startsWith(A)?[e.slice(16),t]:n))}get raw(){return this}}class z extends V{constructor(t){var[t,...r]=t[O](c);super(t,{});for(let t of r)if(t){let[s,r]=e(t,""),[n,i]=e(s,".");(this[n]||=H())[i]=r}}get_uuid_by(t,e){return this.uuids.find(s=>this[s][t]==e)}get_list_of(t){return this.uuids.map(e=>this[e][t])}get uuids(){return this.keys}get[x](){return!!this[E]}toString(){return[this.head,R,...this.flat_map((t,e,s)=>t+"."+e+""+s),R,R].join(c)}toJSON(){return{head:this.head,fmo_infos:this[w]}}}class B extends r{#r;#n;#i;#h;#u;constructor(t){super((t,e=this[y])=>this.check_event(t,e)),this.#r=t,this[y]=t[y]}async check_event(t,e=this[y]){return this.#i?this.#h[e].includes(t):!!this.#n&&(this.#u[e][t]??=await this.#r[d](t))}get[x](){return this.#n}get fast_query_available(){return this.#i}reset(){return this.clear(),this.init()}async init(){var t=this.#r;return this.#n=await t[d](f),this.#i=this.#n&&await t[d](g),this.#i&&(this.#h=await t[p]()),this}clear(){this.#n=this.#i=!1,this.#u={[U]:{},[J]:{}}}}class K{#o;constructor(t,e){return this.RequestHeader={Origin:u},this[m]={Charset:"UTF-8"},this.host=e,this[$]=t,this[S]={[G]:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},this[y]=o,this[j]=new _(this,{get:s({i:(t,e)=>e in t[S]?t[C](e):/^On/.test(e)?t[v]((t=>"_"==t[2]?t[b](3):t)(e)):n})})}set host(t){this.#o=t||h()+"/api/sstp/v1"}get host(){return this.#o}set[$](t){this[m].Sender=t||"jsstp-client"}get[$](){return this[m].Sender}row_send(t){return new Promise((e,s)=>{return fetch(this.#o,{method:"POST",headers:this.RequestHeader,body:R+t})[q](t=>200!=t.status?s(t.status):t.text()[q](e),s)})}[k](t,e){return this.row_send(new Y(t,{...this[m],...e}))}costom_send(t,e){return this[k](t,e)[q](t=>Y.from_string(t))}[C](t){let e=t+" SSTP/"+this[S][t];return l(t=>this.costom_send(e,t),{get_raw:t=>this[k](e,t)})}#a(t,e,s,r){return new _(s,{get:(s,n)=>n in s?s[n]:this[r](t+"."+n,e)})}[N](t,e=G){return this.#a(t,e,s=>this[j][e](l({Event:t},s)),N)}[v](t,e=G){return this.#a(t,e,(...s)=>{let r=0,n={};return s[P](t=>n["Reference"+r++]=t),this[N](t,e)(n)},v)}get event(){return new _({},{get:(t,e)=>this[v](e)})}[d](t,e=this[y]){return this.event[f](t,e)[q](({Result:t})=>1==t)}[p](){return this.event[g]()[q](({[U]:t,[J]:e})=>({[U]:(t||R)[O](","),[J]:(e||R)[O](",")}))}[I](){return this[j].EXECUTE.get_raw({Command:"GetFMO"})[q](t=>new z(t))}[x](){return this[I]()[q](t=>t[x],()=>!1)}[q](t,e){return this[x]()[q](s=>s?t(this):e(),e)}new_event_queryer(){return new B(this).init()}}return l(K.prototype,{type:K,base_sstp_info_t:V,sstp_info_t:Y,fmo_info_t:z,ghost_events_queryer_t:B}),new K})()
