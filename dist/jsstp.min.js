var jsstp=(()=>{var i,o=(t,e)=>{var s=t.indexOf(e);return[t[d](0,s),t[d](s+e[w])]},r=r=>(t,e)=>{var s;if(!r.t||!r.t(t,e))return(s=n(e)instanceof String?r.i&&r.i(t,e):r.h&&r.h(t,e))!==i?s:r.u?r.u(t,e):(s=t[e])instanceof Function?s.bind(t):s},t=!!globalThis.window,e=t=>"http://localhost:"+(t??9801),M=t?location.origin:e(process.env.PORT),U=/^\w+:\/\/localhost/.test(M)?N:P,n=Object,h=Proxy,u=n.assign,_="\r\n",s="Get_Supported_Events",a="Has_Event",D=(t=t=>t.toLowerCase())(s),l=t(a),c="get_simple_caller_of_event",g="trivial_clone",f="default_info",v="default_security_level",p="sstp_version_table",d="substring",w="length",m="available",y="split",S="entries",E="costom_text_send",b="forEach",J="get_caller_of_method",R="unknown_lines",X="get_caller_of_event",O="sendername",T="proxy",x="then",N="local",P="external",C="";class k{get keys(){return n.keys(this)}get values(){return n.values(this)}get[S](){return n[S](this)}get[w](){return this.keys[w]}[b](s){return this[S][b](([t,e])=>{this[t]=s(e,t)??e})}get[g](){return u(F(),this)}flat_map(s){let r=[];return this[S].map(([t,e])=>r.push(...e instanceof k?e.flat_map(s.bind(s,t)):[s(t,e)])),r}map(s){return this[S].map(([t,e])=>s(e,t))}push(t){return t[b](t=>t?this[t[0]]=t[1]:i),this}}var F=()=>new k;class j extends k{#t;#h;constructor(t,e,s={}){super(),this.#t=C+t,s[w]&&(this.#h=s),u(this,e)}get[R](){return this.#h||[]}get head(){return this.#t}toString(){return[this.#t,...this[R],...this[S].map(([t,e])=>t+": "+e),C,C].join(_)}to_string(){return C+this}toJSON(){return{head:this.#t,unknown_lines:this.#h,body:this[g]}}get status_code(){return+this.#t[y](" ").find(t=>(t=+t)==t)}}var q="X-SSTP-PassThru-";class G extends j{constructor(t,e,s={}){return super(t,e,s),new h(this,{get:r({i:(t,e)=>q+e in t?t.get_passthrough(e):i})})}static from_string(t){let e,[s,...r]=t[y](_),i={},n=[];r[w]-=2;for(var h of r){var[u,a]=o(h,": ");/^\w[^\s]*$/.test(u)?i[e=u]=a:e?i[e]+=_+h:n.push(h)}return new G(s,i,n)}get_passthrough(t){return this[q+t]}#u;get passthroughs(){return this.#u??=F().push(this.map((t,e)=>e.startsWith(q)?[e.slice(16),t]:i))}get raw(){return this}}class A extends j{constructor(t){var e,s,r,i,[t,...n]=t[y](_);super(t,{});for(e of n)e&&([r,s]=o(e,""),[r,i]=o(r,"."),(this[r]||=F())[i]=s)}get_uuid_by(e,s){return this.uuids.find(t=>this[t][e]==s)}get_list_of(e){return this.uuids.map(t=>this[t][e])}get uuids(){return this.keys}get[m](){return!!this[w]}toString(){return[this.head,C,...this.flat_map((t,e,s)=>t+"."+e+""+s),C,C].join(_)}toJSON(){return{head:this.head,fmo_infos:this[g]}}}class H{#o;#_;#l;#g;#v;constructor(t){this.#o=t,this[v]=t[v]}async check_event(t,e=this[v]){return this.#l?this.#g[e].includes(t):!!this.#_&&(this.#v[e][t]??=await this.#o[l](t))}get[m](){return this.#_}get fast_query_available(){return this.#l}reset(){return this.clear(),this.init()}async init(){var t=this.#o;return this.#_=await t[l](a),this.#l=this.#_&&await t[l](s),this.#l&&(this.#g=await t[D]()),this}clear(){this.#_=this.#l=!1,this.#v={[N]:{},[P]:{}}}}var V="SEND";class I{#p;constructor(t,e){return this.RequestHeader={Origin:M},this[f]={Charset:"UTF-8"},this.host=e,this[O]=t,this[p]={SEND:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},this[v]=U,this[T]=new h(this,{get:r({i:(t,e)=>e in t[p]?t[J](e):/^On/.test(e)?t[c]("_"==(t=e)[2]?t[d](3):t):i})})}set host(t){this.#p=t||e()+"/api/sstp/v1"}get host(){return this.#p}set[O](t){this[f].Sender=t||"jsstp-client"}get[O](){return this[f].Sender}row_send(t){return new Promise((e,s)=>fetch(this.#p,{method:"POST",headers:this.RequestHeader,body:C+t})[x](t=>200!=t.status?s(t.status):t.text()[x](e)).catch(s))}[E](t,e){return this.row_send(new G(t,{...this[f],...e}))}costom_send(t,e){return this[E](t,e)[x](t=>G.from_string(t))}[J](t){let e=t+" SSTP/"+this[p][t];return u(t=>this.costom_send(e,t),{get_raw:t=>this[E](e,t)})}[X](e,s=V){return t=>this[T][s](u({Event:e},t))}[c](r,i=V){return(...t)=>{let e=0,s={};return t[b](t=>s["Reference"+e++]=t),this[X](r,i)(s)}}get event(){return new h({},{get:(t,e)=>this[c](e)})}[l](t,e=this[v]){return this.event[a](t,e)[x](({Result:t})=>1==t)}[D](){return this.event[s]()[x](({[N]:t,[P]:e})=>({[N]:(t||C)[y](","),[P]:(e||C)[y](",")}))}get_fmo_infos(){return this[T].EXECUTE.get_raw({Command:"GetFMO"})[x](t=>new A(t))}[m](){return this.get_fmo_infos()[x](t=>t[m]).catch(()=>!1)}new_event_queryer(){return new H(this).init()}}return u(I.prototype,{type:I,base_sstp_info_t:j,sstp_info_t:G,fmo_info_t:A,ghost_events_queryer_t:H}),new I})()
