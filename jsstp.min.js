class sstp_info_t{#t;#i;constructor(t,s,e){if(this.set_head(t),this.#i=e,s)if(s.keys)for(var i of s.keys())this[i]=s.get(i);else if("object"==typeof s)for(var n in s)this[n]=s[n];else console.error("sstp_info_t: info_body is not a Map or object: "+typeof s)}static from_string(t){var s=t.split("\r\n")[0],e=new Map,i=t.split("\r\n"),n=(i.shift(),[]),r=[": ",String.fromCharCode(1)];for(let t=0;t<i.length;t++){var a,h,o=i[t];if(""!=o){let s="";for(let t=0;t<r.length;t++)if(-1!=o.indexOf(r[t])){s=r[t];break}""!=s?(a=o.split(s)[0],h=o.replace(a+s,""),e.set(a,h)):n.push(i[t])}}return new sstp_info_t(s,e,n)}set_head(t){this.#t=t=t||"NOTIFY SSTP/1.1"}get_body(){var t,s=new Map;for(t in this)s.set(t,this[t]);return s}get_unknown_lines(){return this.#i}get_head(){return this.#t}to_string(){let t=this.#t+"\r\n";for(var s in this)t+=`${s}: ${this[s]}\r\n`;return t+"\r\n"}return_code(){var s=this.#t.split(" ");for(let t=0;t<s.length;t++)if(!isNaN(s[t]))return parseInt(s[t]);return-1}get_passthrough(t){return this["X-SSTP-PassThru-"+t]}}class sstp_fmo_info_t{constructor(t={}){for(var s in t){var e=s.split(".")[0],i=s.split(".")[1];this[e]||(this[e]={}),this[e][i]=t[s]}}get_uuid_by(t,s){for(var e in this)if(this[e][t]==s)return e;return null}get_list_of(t){var s,e=[];for(s in this)e.push(this[s][t]);return e}keys(){return Object.keys(this)}length(){return this.keys().length}available(){return 0!=this.length()}}class ghost_events_queryer_t{#h;#o;#_;#l;#u;constructor(t=jsstp){this.#h=t}async check_event(t,s="local"){var e;return this.#_?this.#l[s].includes(t):!!this.#o&&(null!=(e=this.#u[s][t])?e:(e=await this.#h.has_event(t),this.#u[s][t]=e))}available(){return this.#o}get_supported_events_available(){return this.#_}async reset(){this.clear(),this.#o=await this.#h.has_event("Has_Event"),this.#_=await this.#h.has_event("Get_Supported_Events"),this.#_&&(this.#l=await this.#h.get_supported_events())}async init(){await this.reset()}clear(){this.#o=!1,this.#_=!1,this.#l=null,this.#u={local:{},external:{}}}}class jsstp_t{#p;#v;#g;constructor(t,s){this.#p=new Map,this.set_host(s),this.set_RequestHeader("Content-Type","text/plain"),window.location.origin&&this.set_RequestHeader("Origin",window.location.origin),this.#v=new Map,this.set_default_info("Charset","UTF-8"),this.set_sendername(t)}set_RequestHeader(t,s){null==s?delete this.#p[t]:this.#p[t]=s}set_default_info(t){this.#v=t}set_default_info(t,s){null==s?delete this.#v[t]:this.#v[t]=s}set_host(t){this.#g=t=t||"http://localhost:9801/api/sstp/v1"}set_sendername(t){this.#v.Sender=t=t||"jsstp-client"}#S(t,s){const i={method:"POST",headers:this.#p,body:t};t=(s,e)=>{fetch(this.#g,i).then(function(t){200!=t.status?e(t.status):t.text().then(function(t){s(sstp_info_t.from_string(t))})})};if(s&&t(s,function(){}),null==s)return new Promise(t)}costom_send(t,s,e){if("object"==typeof s){var i,n,r=new sstp_info_t;for(i in r.set_head(t),this.#v)r[i]=this.#v[i];for(n in s)r[n]=s[n];return this.#S(r.to_string(),e)}console.error("jsstp.send: wrong type of info: "+typeof s)}SEND(t,s){return this.costom_send("SEND SSTP/1.4",t,s)}NOTIFY(t,s){return this.costom_send("NOTIFY SSTP/1.1",t,s)}COMMUNICATE(t,s){return this.costom_send("COMMUNICATE SSTP/1.1",t,s)}EXECUTE(t,s){return this.costom_send("EXECUTE SSTP/1.2",t,s)}GIVE(t,s){return this.costom_send("GIVE SSTP/1.1",t,s)}by_type(type){return eval("this."+type).bind(this)}async has_event(t,s="external"){t=(await this.SEND({Event:"Has_Event",Reference0:t,Reference1:s})).get_passthrough("Result");return!!t&&"0"!=t}async get_supported_events(){var t=await this.SEND({Event:"Get_Supported_Events"}),s=t.get_passthrough("local"),t=t.get_passthrough("external");return{local:s?s.split(","):[],external:t?t.split(","):[]}}async get_fmo_infos(){let t={};try{t=await this.EXECUTE({Command:"GetFMO"})}catch(t){}return new sstp_fmo_info_t(t)}async available(){return(await this.get_fmo_infos()).available()}async new_event_queryer(){var t=new ghost_events_queryer_t(this);return await t.init(),t}}var jsstp=new jsstp_t,jsttp=jsstp,jsttp_t=jsstp_t,sttp_info_t=sstp_info_t,sttp_fmo_info_t=sstp_fmo_info_t;