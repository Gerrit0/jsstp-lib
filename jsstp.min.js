var jsstp=(()=>{let s="Has_Event",r="Get_Supported_Events",n=Object.assign,_="\r\n",h="local",a="external";class c{#t;#i;constructor(t,e,s){this.#t=""+t,this.#i=s||[],n(this,e)}static from_string(t){var s,r,n,[t,...h]=t.split(_),a={},o=[],u=[": ",""];for(s of h)if(s){let t,e;for(var l of u)if(~(e=s.indexOf(l))){t=l;break}t?([r,n]=[s.slice(0,e),s.slice(e+t.length)],a[r]=n):o.push(h[i])}return new c(t,a,o)}get unknown_lines(){return this.#i}get head(){return this.#t}toString(){let t=this.#t+_;for(var e in this)t+=e+": "+this[e]+_;return t+_}to_string(){return this.toString()}toJSON(){var t={head:this.#t,body:n({},this)};return this.#i.length&&(t.unknown_lines=this.#i),t}get return_code(){for(var t in this.#t.split(" "))if(!isNaN(t))return parseInt(t);return-1}get_passthrough(t){return this["X-SSTP-PassThru-"+t]}}class e{constructor(t={}){for(var e in t){var s=e.split("."),r=s[0],s=s[1];this[r]||(this[r]={}),this[r][s]=t[e]}}get_uuid_by(t,e){for(var s in this)if(this[s][t]==e)return s;return null}get_list_of(t){var e,s=[];for(e in this)s.push(this[e][t]);return s}get uuids(){return Object.keys(this)}get keys(){return this.uuids}get length(){return this.keys.length}get available(){return!!this.length}}class t{#h;#o;#u;#l;#_;constructor(t=jsstp){this.#h=t}async check_event(t,e=h){var s;return this.#u?this.#l[e].includes(t):!!this.#o&&(null!=(s=this.#_[e][t])?s:(s=await this.#h.has_event(t),this.#_[e][t]=s))}get available(){return this.#o}get supported_events_available(){return this.#u}async reset(){this.clear();var t=this.#h;return this.#o=await t.has_event(s),this.#u=await t.has_event(r),this.#u&&(this.#l=await t.get_supported_events()),this}async init(){return this.reset()}clear(){this.#o=!1,this.#u=!1,this.#l=this.#_={local:{},external:{}}}}class o{#v;RequestHeader;default_info;constructor(t,e){this.RequestHeader={"Content-Type":"text/plain",Origin:window.location.origin},this.default_info={Charset:"UTF-8"},this.host=e,this.sendername=t}set host(t){this.#v=t||"http://localhost:9801/api/sstp/v1"}get host(){return this.#v}set sendername(t){this.default_info.Sender=t||"jsstp-client"}get sendername(){return this.default_info.Sender}costom_send(t,e,s){t=new c(t,{...this.default_info,...e});let r={method:"POST",headers:this.RequestHeader,body:""+t};e=(e,s)=>{fetch(this.#v,r).then(t=>{200!=t.status?s(t.status):t.text().then(t=>e(c.from_string(t)))})};if(!s)return new Promise(e);e(s,()=>{})}async has_event(t,e=a){t=(await this.SEND({Event:s,Reference0:t,Reference1:e})).get_passthrough("Result");return!!t&&"0"!=t}async get_supported_events(){var t=await this.SEND({Event:r}),e=t.get_passthrough(h),t=t.get_passthrough(a);return{local:(e||"").split(","),external:(t||"").split(",")}}async get_fmo_infos(){let t={};try{t=await this.EXECUTE({Command:"GetFMO"})}catch(t){}return new e(t)}async available(){return(await this.get_fmo_infos()).available}async new_event_queryer(){return new t(this).init()}}let u={SEND:"1.4",NOTIFY:"1.1",COMMUNICATE:"1.1",EXECUTE:"1.2",GIVE:"1.1"};var l=o.prototype;for(let s in u)l[s]=function(t,e){return this.costom_send(s+" SSTP/"+u[s],t,e)};return n(l,{type:o,sstp_info_t:c,fmo_info_t:e,ghost_events_queryer_t:t}),new o})();