class sstp_info_t{#t;#i;constructor(t,s,e){if(this.set_head(t),this.#i=e,s)if(s.keys)for(var i of s.keys())this[i]=s.get(i);else if(s instanceof Object)for(var n in s)this[n]=s[n]}static from_string(t){var s,e,n,r=t.split("\r\n")[0],h=new Map,a=t.split("\r\n"),_=(a.shift(),[]),o=[": ",""];for(s of a)if(s){let t;for(var u of o)if(~s.indexOf(u)){t=u;break}t?(e=s.split(t)[0],n=s.replace(e+t,""),h.set(e,n)):_.push(a[i])}return new sstp_info_t(r,h,_)}set_head(t){this.#t=t=t||"NOTIFY SSTP/1.1"}get_body(){var t,s=new Map;for(t in this)s.set(t,this[t]);return s}get_unknown_lines(){return this.#i}get_head(){return this.#t}toString(){let t=this.#t+"\r\n";for(var s in this)t+=`${s}: ${this[s]}\r\n`;return t+"\r\n"}to_string(){return this.toString()}return_code(){var s=this.#t.split(" ");for(let t=0;t<s.length;t++)if(!isNaN(s[t]))return parseInt(s[t]);return-1}get_passthrough(t){return this["X-SSTP-PassThru-"+t]}}class sstp_fmo_info_t{constructor(t={}){for(var s in t){var e=s.split(".")[0],i=s.split(".")[1];this[e]||(this[e]={}),this[e][i]=t[s]}}get_uuid_by(t,s){for(var e in this)if(this[e][t]==s)return e;return null}get_list_of(t){var s,e=[];for(s in this)e.push(this[s][t]);return e}keys(){return Object.keys(this)}length(){return this.keys().length}available(){return!!this.length()}}class ghost_events_queryer_t{#h;#_;#o;#u;#l;constructor(t=jsstp){this.#h=t}async check_event(t,s="local"){var e;return this.#o?this.#u[s].includes(t):!!this.#_&&(null!=(e=this.#l[s][t])?e:(e=await this.#h.has_event(t),this.#l[s][t]=e))}available(){return this.#_}get_supported_events_available(){return this.#o}async reset(){return this.clear(),this.#_=await this.#h.has_event("Has_Event"),this.#o=await this.#h.has_event("Get_Supported_Events"),this.#o&&(this.#u=await this.#h.get_supported_events()),this}async init(){return this.reset()}clear(){this.#_=!1,this.#o=!1,this.#u=null,this.#l={local:{},external:{}}}}class jsstp_t{#p;#v;#g;constructor(t,s){this.#p=new Map,this.set_host(s),this.set_RequestHeader("Content-Type","text/plain"),this.set_RequestHeader("Origin",window.location.origin),this.#v=new Map,this.set_default_info("Charset","UTF-8"),this.set_sendername(t)}static#S(t,s,e){null==e||""==e?t.delete(s):t[s]=e}set_RequestHeader(t,s){jsstp_t.#S(this.#p,t,s)}reset_default_info(t){this.#v=t}set_default_info(t,s){jsstp_t.#S(this.#v,t,s)}set_host(t){this.#g=t=t||"http://localhost:9801/api/sstp/v1"}set_sendername(t){this.#v.Sender=t=t||"jsstp-client"}#T(t,s){const i={method:"POST",headers:this.#p,body:t};t=(s,e)=>{fetch(this.#g,i).then(function(t){200!=t.status?e(t.status):t.text().then(t=>s(sstp_info_t.from_string(t)))})};if(!s)return new Promise(t);t(s,function(){})}costom_send(t,s,e){if(s instanceof Object){var i,n,r=new sstp_info_t;for(i in r.set_head(t),this.#v)r[i]=this.#v[i];for(n in s)r[n]=s[n];return this.#T(""+r,e)}}SEND(t,s){return this.costom_send("SEND SSTP/1.4",t,s)}NOTIFY(t,s){return this.costom_send("NOTIFY SSTP/1.1",t,s)}COMMUNICATE(t,s){return this.costom_send("COMMUNICATE SSTP/1.1",t,s)}EXECUTE(t,s){return this.costom_send("EXECUTE SSTP/1.2",t,s)}GIVE(t,s){return this.costom_send("GIVE SSTP/1.1",t,s)}by_type(type){return eval("this."+type).bind(this)}async has_event(t,s="external"){t=(await this.SEND({Event:"Has_Event",Reference0:t,Reference1:s})).get_passthrough("Result");return!!t&&"0"!=t}async get_supported_events(){var t=await this.SEND({Event:"Get_Supported_Events"}),s=t.get_passthrough("local"),t=t.get_passthrough("external");return{local:s?s.split(","):[],external:t?t.split(","):[]}}async get_fmo_infos(){let t={};try{t=await this.EXECUTE({Command:"GetFMO"})}catch(t){}return new sstp_fmo_info_t(t)}async available(){return(await this.get_fmo_infos()).available()}async new_event_queryer(){return new ghost_events_queryer_t(this).init()}}var jsstp=new jsstp_t,jsttp=jsstp,jsttp_t=jsstp_t,sttp_info_t=sstp_info_t,sttp_fmo_info_t=sstp_fmo_info_t;