class sstp_info_t{#head;#unknown_lines;constructor(a,b,c){if(this.set_head(a),this.#unknown_lines=c,b)if(b.keys)for(var d of b.keys())this[d]=b.get(d);else if("object"==typeof b)for(var d in b)this[d]=b[d];else console.error("sstp_info_t: info_body is not a Map or object: "+typeof b)}static from_string(a){var b=String.fromCharCode,c=a.split("\r\n")[0],d=new Map,e=a.split("\r\n");e.shift();for(var f,g=[],h=[": ",b(1)],k=0;k<e.length;k++)if(f=e[k],""!=f){for(var l="",m=0;m<h.length;m++)if(-1!=f.indexOf(h[m])){l=h[m];break}if(""!=l){var n=f.split(l)[0],o=f.replace(n+l,"");d.set(n,o)}else g.push(e[k])}return new sstp_info_t(c,d,g)}set_head(a){a==null&&(a="NOTIFY SSTP/1.1"),this.#head=a}get_body(){var a=new Map;for(var b in this)a.set(b,this[b]);return a}get_unknown_lines(){return this.#unknown_lines}get_head(){return this.#head}to_string(){var a=this.#head+"\r\n";for(var b in this)a+=`${b}: ${this[b]}\r\n`;return a+="\r\n",a}return_code(){for(var a=this.#head.split(" "),b=0;b<a.length;b++)if(!isNaN(a[b]))return parseInt(a[b]);return-1}}class jsstp_t{#headers;#default_info;#host;constructor(a,b){if(this.#headers=new Map,this.set_host(b),this.set_RequestHeader("Content-Type","text/plain"),window.location){var c=window.location.protocol+"//"+window.location.host;"file:"==window.location.protocol&&(c="http://localhost"),this.set_RequestHeader("Origin",c)}this.#default_info=new Map,this.set_default_info("Charset","UTF-8"),this.set_sendername(a)}set_RequestHeader(a,b){null==b?delete this.#headers[a]:this.#headers[a]=b}set_default_info(a){this.#default_info=a}set_default_info(a,b){null==b?delete this.#default_info[a]:this.#default_info[a]=b}set_host(a){a==null&&(a="http://localhost:9801/api/sstp/v1"),this.#host=a}set_sendername(a){a==null&&(a="jsstp-client"),this.#default_info.Sender=a}#base_post(a,b){const c={method:"POST",headers:this.#headers,body:a};var d=(a,b)=>{fetch(this.#host,c).then(function(c){200==c.status?c.text().then(function(b){a(sstp_info_t.from_string(b))}):b(c.status)})};if(b&&d(b,function(){}),null==b)return new Promise(d)}costom_send(a,b,c){if("object"==typeof b){var d=new sstp_info_t;for(var e in d.set_head(a),this.#default_info)d[e]=this.#default_info[e];for(var e in b)d[e]=b[e];return this.#base_post(d.to_string(),c)}console.error("jsstp.send: wrong type of info: "+typeof b)}SEND(a,b){return this.costom_send("SEND SSTP/1.4",a,b)}NOTIFY(a,b){return this.costom_send("NOTIFY SSTP/1.1",a,b)}COMMUNICATE(a,b){return this.costom_send("COMMUNICATE SSTP/1.1",a,b)}EXECUTE(a,b){return this.costom_send("EXECUTE SSTP/1.2",a,b)}GIVE(a,b){return this.costom_send("GIVE SSTP/1.1",a,b)}by_type(type){return eval("this."+type).bind(this)}}var jsstp=new jsstp_t,jsttp=jsstp,jsttp_t=jsstp_t,sttp_info_t=sstp_info_t;