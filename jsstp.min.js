class sstp_info_t{#t;#e;constructor(t,e,s){if(this.set_head(t),this.#e=s,e)if(e.keys)for(let t of e.keys())this[t]=e.get(t);else if("object"==typeof e)for(let t in e)this[t]=e[t];else console.error("sstp_info_t: info_body is not a Map or object: "+typeof e)}static from_string(t){let e=t.split("\r\n")[0],s=new Map,n=t.split("\r\n");n.shift();let i=[],_=[": ",String.fromCharCode(1)];for(let t=0;t<n.length;t++){let e=n[t];if(""==e)continue;let h="";for(let t=0;t<_.length;t++)if(-1!=e.indexOf(_[t])){h=_[t];break}if(""!=h){let t=e.split(h)[0],n=e.replace(t+h,"");s.set(t,n)}else i.push(n[t])}return new sstp_info_t(e,s,i)}set_head(t){null==t&&(t="NOTIFY SSTP/1.1"),this.#t=t}get_body(){let t=new Map;for(let e in this)t.set(e,this[e]);return t}get_unknown_lines(){return this.#e}get_head(){return this.#t}to_string(){let t=this.#t+"\r\n";for(let e in this)t+=`${e}: ${this[e]}\r\n`;return t+="\r\n",t}return_code(){let t=this.#t.split(" ");for(let e=0;e<t.length;e++)if(!isNaN(t[e]))return parseInt(t[e]);return-1}get_passthrough(t){return this["X-SSTP-PassThru-"+t]}}class sstp_fmo_info_t{constructor(t={}){for(let e in t){let s=e.split(".")[0],n=e.split(".")[1];this[s]||(this[s]={}),this[s][n]=t[e]}}get_uuid_by(t,e){for(let s in this)if(this[s][t]==e)return s;return null}get_list_of(t){let e=[];for(let s in this)e.push(this[s][t]);return e}keys(){return Object.keys(this)}length(){return this.keys().length}available(){return 0!=this.length()}}class ghost_events_queryer_t{#s;#n;#i;#_;#h;constructor(t=jsstp){this.#s=t}async check_event(t,e="local"){if(this.#i)return this.#_[e].includes(t);if(this.#n){if(null!=this.#h[e][t])return this.#h[e][t];let s=await this.#s.has_event(t);return this.#h[e][t]=s,s}return!1}available(){return this.#n}get_supported_events_available(){return this.#i}async reset(){this.clear(),this.#n=await this.#s.has_event("Has_Event"),this.#i=await this.#s.has_event("Get_Supported_Events"),this.#i&&(this.#_=await this.#s.get_supported_events())}async init(){await this.reset()}clear(){this.#n=!1,this.#i=!1,this.#_=null,this.#h={local:{},external:{}}}}class jsstp_t{#o;#r;#a;constructor(t,e){this.#o=new Map,this.set_host(e),this.set_RequestHeader("Content-Type","text/plain"),window.location.origin&&this.set_RequestHeader("Origin",window.location.origin),this.#r=new Map,this.set_default_info("Charset","UTF-8"),this.set_sendername(t)}set_RequestHeader(t,e){null==e?delete this.#o[t]:this.#o[t]=e}set_default_info(t){this.#r=t}set_default_info(t,e){null==e?delete this.#r[t]:this.#r[t]=e}set_host(t){null==t&&(t="http://localhost:9801/api/sstp/v1"),this.#a=t}set_sendername(t){null==t&&(t="jsstp-client"),this.#r.Sender=t}#l(t,e){const s={method:"POST",headers:this.#o,body:t};let n=(t,e)=>{fetch(this.#a,s).then((function(s){200!=s.status?e(s.status):s.text().then((function(e){t(sstp_info_t.from_string(e))}))}))};if(e&&n(e,(function(){})),null==e)return new Promise(n)}costom_send(t,e,s){if("object"==typeof e){let n=new sstp_info_t;n.set_head(t);for(let t in this.#r)n[t]=this.#r[t];for(let t in e)n[t]=e[t];return this.#l(n.to_string(),s)}console.error("jsstp.send: wrong type of info: "+typeof e)}SEND(t,e){return this.costom_send("SEND SSTP/1.4",t,e)}NOTIFY(t,e){return this.costom_send("NOTIFY SSTP/1.1",t,e)}COMMUNICATE(t,e){return this.costom_send("COMMUNICATE SSTP/1.1",t,e)}EXECUTE(t,e){return this.costom_send("EXECUTE SSTP/1.2",t,e)}GIVE(t,e){return this.costom_send("GIVE SSTP/1.1",t,e)}by_type(type){return eval("this."+type).bind(this)}async has_event(t,e="external"){const s=(await this.SEND({Event:"Has_Event",Reference0:t,Reference1:e})).get_passthrough("Result");return!!s&&"0"!=s}async get_supported_events(){const t=await this.SEND({Event:"Get_Supported_Events"}),e=t.get_passthrough("local"),s=t.get_passthrough("external");return{local:e?e.split(","):[],external:s?s.split(","):[]}}async get_fmo_infos(){let t={};try{t=await this.EXECUTE({Command:"GetFMO"})}catch(t){}return new sstp_fmo_info_t(t)}async available(){return(await this.get_fmo_infos()).available()}async new_event_queryer(){let t=new ghost_events_queryer_t(this);return await t.init(),t}}var jsstp=new jsstp_t,jsttp=jsstp,jsttp_t=jsstp_t,sttp_info_t=sstp_info_t,sttp_fmo_info_t=sstp_fmo_info_t;