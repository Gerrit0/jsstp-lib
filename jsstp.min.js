var jsstp=(()=>{let t=Object,r=t.assign,o="\r\n";class n{get keys(){return t.keys(this)}get values(){return t.values(this)}get entries(){return t.entries(this)}get length(){return this.keys.length}forEach(s){return this.entries.forEach(([t,e])=>{this[t]=s(e,t)||e})}get trivial_clone(){return r(h(),this)}flat_map(s){let r=[];return this.entries.map(([t,e])=>{e instanceof n?r.push(...e.flat_map(s.bind(s,t))):r.push(s(t,e))}),r}}let h=()=>new n,u=(t,e)=>{var s=t.indexOf(e);return[t.substring(0,s),t.substring(s+e.length)]},s=t=>t.startsWith("On"),i=t=>"_"==t[2]?t.substring(3):t,e=t=>t==t;class a{constructor(r){return(e,s)=>{if(!r.block||!r.block(e,s)){let t;switch(typeof s){case"string":r.string_key_handler&&(t=r.string_key_handler(e,s));break;case"symbol":r.symbol_key_handler&&(t=r.symbol_key_handler(e,s))}return t?t:r.default_handler?r.default_handler(e,s):(t=e[s])instanceof Function?t.bind(e):t}}}}let _="X-SSTP-PassThru-";class l extends n{#t;#i;constructor(t,e,s={}){return super(),this.#t=""+t,s.length&&(this.#i=s),r(this,e),new Proxy(this,{get:new a({string_key_handler:(t,e)=>_+e in t?t.get_passthrough(e):void 0})})}static from_string(t){var e,[t,...s]=t.split(o),r={},n=[];let i;s.length-=2;for(e of s){var[h,a]=u(e,": ");/^\w[^\s]*$/.test(h)?r[i=h]=a:i?r[i]+=o+e:n.push(e)}return new l(t,r,n)}get unknown_lines(){return this.#i||[]}get head(){return this.#t}toString(){return[this.#t,...this.unknown_lines,...this.entries.map(([t,e])=>t+": "+e),"",""].join(o)}to_string(){return this.toString()}toJSON(){return{head:this.#t,unknown_lines:this.#i,body:this.trivial_clone}}get return_code(){return+this.#t.split(" ").find(t=>e(+t))}get_passthrough(t){return this[_+t]}}class c extends l{constructor(t){var e,s,r,n,[t,...i]=t.split(o);super(t,{});for(e of i)e&&([r,s]=u(e,""),[r,n]=u(r,"."),this[r]||=h(),this[r][n]=s)}get_uuid_by(e,s){return this.uuids.find(t=>this[t][e]==s)}get_list_of(e){return this.uuids.map(t=>this[t][e])}get uuids(){return this.keys}get available(){return!!this.length}toString(){return[this.head,"",...this.flat_map((t,e,s)=>t+"."+e+""+s),"",""].join(o)}toJSON(){return{head:this.head,fmo_infos:this.trivial_clone}}}class g{#h;#o;#u;#_;#l;constructor(t=jsstp){this.#h=t}async check_event(t,e="local"){var s;return this.#u?this.#_[e].includes(t):!!this.#o&&(null!=(s=this.#l[e][t])?s:(s=await this.#h.has_event(t),this.#l[e][t]=s))}get available(){return this.#o}get fast_query_available(){return this.#u}async reset(){this.clear();var t=this.#h;return this.#o=await t.has_event("Has_Event"),this.#u=this.#o&&await t.has_event("Get_Supported_Events"),this.#u&&(this.#_=await t.get_supported_events()),this}async init(){return this.reset()}clear(){this.#o=this.#u=!1,this.#l={local:{},external:{}}}}let v={SEND:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},d=t=>t+" SSTP/"+v[t];class f{#g;proxy;RequestHeader;default_info;static sstp_version_table=v;constructor(t,e){return this.RequestHeader={"Content-Type":"text/plain",Origin:window.location.origin},this.default_info={Charset:"UTF-8"},this.host=e,this.sendername=t,this.proxy=new Proxy(this,{get:new a({string_key_handler:(t,e)=>e in v?t.get_caller_of_method(e):s(e)?t.get_simple_caller_of_event(i(e)):void 0})}),this.proxy}set host(t){this.#g=t||"http://localhost:9801/api/sstp/v1"}get host(){return this.#g}set sendername(t){this.default_info.Sender=t||"jsstp-client"}get sendername(){return this.default_info.Sender}costom_text_send(t,r){return new Promise((e,s)=>fetch(this.host,{method:"POST",headers:this.RequestHeader,body:""+new l(t,{...this.default_info,...r})}).then(t=>200!=t.status?s(t.status):t.text().then(e)).catch(s))}async costom_send(t,e){return this.costom_text_send(t,e).then(t=>l.from_string(t))}get_caller_of_method(t){let e=d(t);return r(t=>this.costom_send(e,t),{get_result_by_text:t=>this.costom_text_send(e,t)})}get_caller_of_event(e,s="SEND"){return t=>this.proxy[s](r({Event:e},t))}get_simple_caller_of_event(r,n="SEND"){return(...t)=>{let e=0,s={};return t.forEach(t=>s["Reference"+e++]=t),this.get_caller_of_event(r,n)(s)}}get event(){return new Proxy({},{get:(t,e)=>this.get_simple_caller_of_event(e)})}async has_event(t,e="external"){t=(await this.event.Has_Event(t,e)).Result;return!!t&&"0"!=t}async get_supported_events(){var t=await this.event.Get_Supported_Events(),[t,e]=[t.local,t.external];return{local:(t||"").split(","),external:(e||"").split(",")}}async get_fmo_infos(){return this.proxy.EXECUTE.get_result_by_text({Command:"GetFMO"}).then(t=>new c(t))}async available(){return this.get_fmo_infos().then(t=>t.available).catch(()=>!1)}async new_event_queryer(){return new g(this).init()}}return r(f.prototype,{type:f,sstp_info_t:l,fmo_info_t:c,ghost_events_queryer_t:g}),new f})();