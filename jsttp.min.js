class sttp_info_t{#head;constructor(a,b){if(this.set_head(a),b)if("Map"==typeof b)for(var c of b.keys())this[c]=b.get(c);else if("object"==typeof b)for(var c in b)this[c]=b[c];else console.error("sttp_info_t: info_body is not a Map or object: "+typeof b)}static from_string(a){var b=a.split("\r\n")[0],c=new Map,d=a.split("\r\n");d.shift();for(var e=0;e<d.length;e++){var f=d[e].split(": ")[0],g=d[e].split(": ")[1];""!=f&&g!=null&&(c[f]=g)}return new sttp_info_t(b,c)}set_head(a){a==null&&(a="NOTIFY SSTP/1.1"),this.#head=a}get_body(){var a=new Map;for(var b in this)a.set(b,this[b]);return a}get_head(){return this.#head}to_string(){var a=this.#head+"\r\n";for(var b in this)a+=`${b}: ${this[b]}\r\n`;return a+="\r\n",a}return_code(){for(var a=this.#head.split(" "),b=0;b<a.length;b++)if(!isNaN(a[b]))return parseInt(a[b]);return-1}}class jsttp_t{#headers;#default_info;#host;#server_url;constructor(){this.#headers=new Map,this.set_host(),this.set_RequestHeader("Content-Type","text/plain"),this.set_RequestHeader("Origin",this.#server_url),this.#default_info=new Map,this.#default_info.Charset="UTF-8",this.set_sendername()}set_RequestHeader(a,b){null==b?delete this.#headers[a]:this.#headers[a]=b}set_default_info(a){this.#default_info=a}set_default_info(a,b){null==b?delete this.#default_info[a]:this.#default_info[a]=b}set_host(a){a==null&&(a="http://localhost:9801/api/sstp/v1"),this.#host=a,this.#server_url=a.split("api/sstp")[0],this.set_RequestHeader("Origin",this.#server_url)}set_sendername(a){a==null&&(a="jsstp-client"),this.#default_info.Sender=a}#base_post(a,b){const c={method:"POST",headers:this.#headers,body:a};b&&fetch(this.#host,c).then(function(a){200==a.status?a.text().then(function(a){b(sttp_info_t.from_string(a))}):b(a.status)}),b==null&&new Promise(function(a,b){fetch(this.#host,c).then(function(c){200==c.status?c.text().then(function(b){a(sttp_info_t.from_string(b))}):b(c.status)})})}costom_send(a,b,c){if("object"==typeof b){var d=new sttp_info_t;for(var e in d.set_head(a),this.#default_info)d[e]=this.#default_info[e];for(var e in b)d[e]=b[e];return this.#base_post(d.to_string(),c)}console.error("jsttp.send: wrong type of info: "+typeof b)}SEND(a,b){return this.costom_send("SEND SSTP/1.4",a,b)}NOTIFY(a,b){return this.costom_send("NOTIFY SSTP/1.1",a,b)}COMMUNICATE(a,b){return this.costom_send("COMMUNICATE SSTP/1.1",a,b)}EXECUTE(a,b){return this.costom_send("EXECUTE SSTP/1.2",a,b)}GIVE(a,b){return this.costom_send("GIVE SSTP/1.1",a,b)}}var jsttp=new jsttp_t;